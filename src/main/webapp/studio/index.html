<%@ page contentType="text/html" pageEncoding="UTF-8" session="false" trimDirectiveWhitespaces="true"
    import="java.util.List" %>
<jsp:useBean id="studio" scope="request" class="com.feedhenry.studio.StudioBean"></jsp:useBean>
<%
studio.init( application );
String pageName = com.feedhenry.studio.StudioBean.IDE_INDEX;
String csrftoken = null;
try {
  if( studio.initreq( request, response, pageName ) ) {
        csrftoken = (String) request.getAttribute("csrftoken");
    if( studio.canProceed( request, response, pageName ) ) {
%>
<!DOCTYPE html>
<html>

  <head>
    <!-- common head elements -->
    <%@ include file="inc/header/common.html"%>
  </head>
  
  <body style="display:none;">
    <input name="csrftoken" value="<%=csrftoken %>" type="hidden" />
    <%@ include file="common.html" %>
    
    <%@ include file="inc/index/main.html"%>
    
	  <script id="IntercomSettingsScriptTag">
	  if ($fw.getUserProp('created') != null) {
		  var intercomSettings = {
		    app_id: 'xbv6bi62',
		    email: $fw.getUserProp('email'),
		    created_at: ($fw.getUserProp('created') / 1000),
		    custom_data: {
		      domain: $fw.getUserProp('domain'),
		      host: document.location.host,
		      accountType: $fw.getUserProp('accountType')
		    }
		  };
    }
		</script>
		<script>
		if (typeof intercomSettings != 'undefined' && ENVIRONMENT === 'prod') {
		  console.log('Intercom initialising');
		  (function() {
		    function async_load() {
		      var s = document.createElement('script');
		      s.type = 'text/javascript'; s.async = true;
		      s.src = 'https://api.intercom.io/api/js/library.js';
		      var x = document.getElementsByTagName('script')[0];
		      x.parentNode.insertBefore(s, x);
		    }
		    if (window.attachEvent) {
		      window.attachEvent('onload', async_load);
		    } else {
		      window.addEventListener('load', async_load, false);
		    }
		  })();
    } else {
      console.log('Intercom disabled');
    }
		</script>
		
  </body>


  <!-- Load scripts after body -->
  
  <!--[if lt IE 9]>
    <script src="<%=studio.getStaticAssetPath("common/js/ui/thirdparty/jquery/plugins/jqplot/excanvas.js")%>" type="text/javascript"></script>
  <![endif]-->
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script type='text/javascript'>
    try {
      google.load('visualization', '1', {'packages': ['geochart']});
    } catch(e) {
      console.log('Google Visualisation API not loaded - no internet connection?');
    }
  </script>

  <%= studio.getIdeScripts() %>
  
</html>
<%
    }
  }
} catch( Exception e ) {
  studio.error(e);
}
%>